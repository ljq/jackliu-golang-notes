# 锁机制用法

### 注意事项
* 锁的粒度越小越好，加锁后尽快释放锁。
* 当前逻辑执行完毕时及时释放锁，防止锁被其他逻辑延迟释放。
* 尽量**不用defer**释放锁,避免逻辑过多时锁粒度跨度过大或持有时间过长，锁得不到及时释放（参看defer的运行机制），**defer虽然适用在资源释放的场景，但不适合锁的持有和释放**。
* 尽量**不要嵌套读锁**，否则会导致在一些场景下出现读锁和写锁互相等待对方发送信号，产生死锁或者死循环。
